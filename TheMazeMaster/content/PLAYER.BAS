PLAYER_CREATURE_INDEX=0
DEF GENERATE_PLAYER()
    L=GET_CREATURETYPE_MINIMUM_EXIT_COUNT(CREATURETYPE_DUDE)
    H=GET_CREATURETYPE_MINIMUM_EXIT_COUNT(CREATURETYPE_DUDE)
    DO
        MX=RND(0,MAZE_COLUMNS-1)
        MY=RND(0,MAZE_ROWS-1)
        E=GET_MAZE_CELL_EXITS(MX,MY)
    UNTIL E>=L AND E<=H
    PLAYER_CREATURE_INDEX=CREATE_CREATURE(CREATURETYPE_DUDE,MX,MY,7,7)
ENDDEF
DEF MOVE_PLAYER(D)
    I=PLAYER_CREATURE_INDEX
    IF CREATURE_ALIVE(I) THEN
        X=CREATURE_ROOM_COLUMN(I)
        Y=CREATURE_ROOM_ROW(I)
        NX=STEP_X(D,X,Y)
        NY=STEP_Y(D,X,Y)
        MX=CREATURE_MAZE_COLUMN(I)
        MY=CREATURE_MAZE_ROW(I)
        IF NX<0 OR NY<0 OR NX>=ROOM_COLUMNS OR NY>=ROOM_ROWS THEN
            CREATURE_MAZE_COLUMN(I) = STEP_X(D,MX,MY)
            CREATURE_MAZE_ROW(I) = STEP_Y(D,MX,MY)
            IF NX<0 THEN
                CREATURE_ROOM_COLUMN(I)=NX+ROOM_COLUMNS
            ELSEIF NX>=ROOM_COLUMNS THEN
                CREATURE_ROOM_COLUMN(I)=NX-ROOM_COLUMNS
            ELSE
                CREATURE_ROOM_COLUMN(I)=NX
            ENDIF
            IF NY<0 THEN
                CREATURE_ROOM_ROW(I)=NY+ROOM_ROWS
            ELSEIF NY>=ROOM_ROWS THEN
                CREATURE_ROOM_ROW(I)=NY-ROOM_ROWS
            ELSE
                CREATURE_ROOM_ROW(I)=NY
            ENDIF
        ELSE
            TL=GET_ROOM_TILE(MX,MY,NX,NY)
            IF CAN_WALK_ON_TILE(TL) THEN
                CREATURE_ROOM_COLUMN(I)=NX
                CREATURE_ROOM_ROW(I)=NY
            ENDIF
        ENDIF
    ENDIF
ENDDEF
