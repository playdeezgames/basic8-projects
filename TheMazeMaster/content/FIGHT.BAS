FIGHT_CREATURE_INDEX=-1
FIGHT_MESSAGES=LIST()
DEF FIGHT_START()
    CLEAR(FIGHT_MESSAGES)
    DI=FIGHT_CREATURE_INDEX
    AI=PLAYER_CREATURE_INDEX
    PUSH(FIGHT_MESSAGES,"FIGHTING "+GET_CREATURE_NAME(DI))
    PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(AI)+" HAS "+STR(GET_CREATURE_HEALTH(AI))+" HP")
    PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(DI)+" HAS "+STR(GET_CREATURE_HEALTH(DI))+" HP")
    PUSH(FIGHT_MESSAGES,"(A)TTACK/(R)UN/(U)SE")
ENDDEF
DEF RESOLVE_ATTACK(AI,DI)
    PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(AI)+" ATTACKS "+GET_CREATURE_NAME(DI))
    AR = CREATURE_ROLL_ATTACK(AI)
    DR = CREATURE_ROLL_DEFEND(DI)
    PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(AI)+" ROLLS "+STR(AR))
    PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(DI)+" ROLLS "+STR(DR))
    IF AR>DR THEN
        D=AR-DR
        PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(AI)+" HITS FOR "+STR(D))
    ELSE
        PUSH(FIGHT_MESSAGES,GET_CREATURE_NAME(AI)+" MISSES")
    ENDIF
ENDDEF
DEF FIGHT_ATTACK()
    DI=FIGHT_CREATURE_INDEX
    AI=PLAYER_CREATURE_INDEX
    RESOLVE_ATTACK(AI,DI)
    IF CREATURE_ALIVE(DI) THEN
        RESOLVE_ATTACK(DI,AI)
    ENDIF
    IF CREATURE_ALIVE(AI) THEN
        PUSH(FIGHT_MESSAGES,"(A)TTACK/(R)UN/(U)SE")
    ELSE
        PUSH(FIGHT_MESSAGES,"YER DEAD")
    ENDIF
ENDDEF
DEF FIGHT_UPDATE(DELTA)
    WHILE LEN(FIGHT_MESSAGES)>16
        REMOVE(FIGHT_MESSAGES,0)
    WEND
    FOR R=0 TO LEN(FIGHT_MESSAGES)-1
        TEXT 0,R*8,FIGHT_MESSAGES(R)
    NEXT R
    IF KEYP CODE_R THEN
        RETURN STATE_IN_PLAY
    ELSEIF KEYP CODE_A THEN
        FIGHT_ATTACK()
    ELSEIF KEYP CODE_U THEN
        'USE ITEM
    ENDIF
    RETURN STATE_FIGHT
ENDDEF