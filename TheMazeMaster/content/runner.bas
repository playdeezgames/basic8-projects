IMPORT "directions.bas"
IMPORT "maze.bas"
IMPORT "keycodes.bas"
IMPORT "displaymap.bas"
IMPORT "PASSAGEWAYS.BAS"
IMPORT "CHAMBERS.BAS"
IMPORT "CREATURESPRITES.BAS"
IMPORT "ROOM.BAS"
IMPORT "PLAYER.BAS"
GENERATE_MAZE()
GENERATE_ROOMS()

DEF DRAW_MAP()
    ROOM_MAP = GET_ROOM_MAP(PLAYER_ATLAS_COLUMN,PLAYER_ATLAS_ROW)
    MAP ROOM_MAP,0,0
ENDDEF

DEF DRAW_PLAYER()
    SPR CREATURE_SPRITES(SPRITE_DUDE),PLAYER_ROOM_COLUMN*ROOM_CELL_WIDTH,PLAYER_ROOM_ROW*ROOM_CELL_HEIGHT
ENDDEF

DEF MOVE_PLAYER()
    IF KEYP CODE_UP THEN
        IF PLAYER_ROOM_ROW>0 THEN 
            PLAYER_ROOM_ROW=PLAYER_ROOM_ROW-1
		ELSE
	        IF PLAYER_ATLAS_ROW>0 THEN 
	            PLAYER_ATLAS_ROW=PLAYER_ATLAS_ROW-1
				PLAYER_ROOM_ROW=ROOM_ROWS-1
	        ENDIF
		ENDIF
    ELSEIF KEYP CODE_DOWN THEN
        IF PLAYER_ROOM_ROW<ROOM_ROWS-1 THEN
            PLAYER_ROOM_ROW=PLAYER_ROOM_ROW+1
		ELSE
	        IF PLAYER_ATLAS_ROW<MAZE_ROWS-1 THEN
 	           PLAYER_ATLAS_ROW=PLAYER_ATLAS_ROW+1
				PLAYER_ROOM_ROW=0
  	        ENDIF
		ENDIF
    ELSEIF KEYP CODE_LEFT THEN
        IF PLAYER_ROOM_COLUMN>0 THEN 
            PLAYER_ROOM_COLUMN=PLAYER_ROOM_COLUMN-1
		ELSE
	        IF PLAYER_ATLAS_COLUMN>0 THEN
				PLAYER_ROOM_COLUMN=ROOM_COLUMNS-1
	            PLAYER_ATLAS_COLUMN=PLAYER_ATLAS_COLUMN-1
	        ENDIF
        ENDIF
    ELSEIF KEYP CODE_RIGHT THEN
        IF PLAYER_ROOM_COLUMN<ROOM_COLUMNS-1 THEN 
            PLAYER_ROOM_COLUMN=PLAYER_ROOM_COLUMN+1
        ELSE
        	IF PLAYER_ATLAS_COLUMN<MAZE_COLUMNS-1 THEN
				PLAYER_ROOM_COLUMN=0
         	    PLAYER_ATLAS_COLUMN=PLAYER_ATLAS_COLUMN+1
	        ENDIF
		ENDIF
    ENDIF
ENDDEF

DEF UPDATE(DELTA)
    DRAW_MAP()
    DRAW_PLAYER()
    MOVE_PLAYER()
ENDDEF

DEF RUN()
    DRV = DRIVER()
    UPDATE_WITH(DRV, CALL(UPDATE))
ENDDEF

